<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ¥­è²¡å‹™å°å¸³è¨ˆç®—æ©Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* ç¢ºä¿å­—é«”ç‚º Inter */
        body {
            font-family: 'Inter', sans-serif;
            /* èª¿æ•´ç‚ºæ›´æŸ”å’Œçš„æ·ºç°è‰²èƒŒæ™¯ï¼Œå¢åŠ å°ˆæ¥­æ„Ÿ */
            background-color: #f7f9fb; 
        }
        /* éš±è—æ•¸å­—è¼¸å…¥æ¡†ç®­é ­ */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        /* å°ˆæ¥­æ•¸å­—å­—é«”ï¼šç¢ºä¿æ•¸å­—ç­‰å¯¬å°é½Š */
        .financial-input {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            /* èª¿æ•´å­—é«”å¤§å°å’Œç²—ç´°ä»¥æé«˜å¯è®€æ€§ */
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen flex items-center justify-center">

    <div id="app-container" class="w-full max-w-xl bg-white shadow-2xl rounded-2xl p-6 sm:p-8 border border-gray-100">
        <h1 class="text-3xl font-extrabold text-slate-900 mb-6 text-center border-b pb-3 border-slate-100">
            ğŸ“Š è²¡å‹™å°å¸³è¨ˆç®—å„€è¡¨æ¿
        </h1>

        <div class="bg-blue-50 border-l-4 border-blue-600 text-blue-900 p-4 rounded-lg mb-6 shadow-sm">
            <p class="font-bold mb-2 text-lg">å°å¸³ç›®æ¨™ï¼š<span class="text-green-600">å·®ç•°ç‚º 0</span></p>
            <p class="text-sm font-medium italic text-gray-700">
                å…¬å¼ï¼š(POS æ”¶å…¥) - (é å”®çµå¸³ + AC+) - (SKM1 + SKM2 + ç†Ÿå®¢ + å¤–å¸³) = å·®ç•°
            </p>
            <ul class="list-disc list-inside mt-3 text-sm space-y-1">
                <li class="text-green-700"><span class="font-bold">æ­£å€¼ (+)</span>: æ–°å…‰å°‘æ”¶éŒ¢ (éœ€è£œæ˜ç´°é€€æ¬¾)</li>
                <li class="text-red-700"><span class="font-bold">è² å€¼ (-)</span>: æ–°å…‰å¤šæ”¶éŒ¢ (éœ€è£œæ˜ç´°å…¥å¸³)</li>
            </ul>
        </div>

        <div id="inputs-container" class="space-y-4">
            
            <h2 class="text-xl font-bold text-blue-700 pt-4 mb-2 border-t border-gray-200">POS éŠ·è²¨é …ç›® (æ”¶å…¥)</h2>
            <div class="grid grid-cols-3 gap-4">
                
                <div class="input-group col-span-3">
                    <label for="paymentTotal" class="block text-sm font-medium text-gray-700">Payment Total</label>
                    <input type="text" id="paymentTotal" value="0"
                        class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-inner focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out financial-input text-left bg-blue-50 font-bold">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="input-group">
                    <label for="preSaleSettlement" class="block text-sm font-medium text-gray-700">é å”®çµå¸³ (æ¸›é …)</label>
                    <input type="text" id="preSaleSettlement" value="0"
                        class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out financial-input text-left">
                </div>

                <div class="input-group">
                    <label for="acPlus" class="block text-sm font-medium text-gray-700">AC+ (æ¸›é …)</label>
                    <input type="text" id="acPlus" value="0"
                        class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out financial-input text-left">
                </div>
            </div>
            
            <h2 class="text-xl font-bold text-blue-700 pt-4 border-t border-gray-200 mt-6 mb-2">æ–°å…‰/å¤–å¸³ (æ‡‰æ”¶é …ç›®)</h2>
            
            <div class="grid grid-cols-2 gap-4">
                <div class="input-group">
                    <label for="skm1Amount" class="block text-sm font-medium text-gray-700">SKM 1</label>
                    <input type="text" id="skm1Amount" value="0"
                        class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out financial-input text-left">
                </div>
                
                <div class="input-group">
                    <label for="skm2Amount" class="block text-sm font-medium text-gray-700">SKM 2</label>
                    <input type="text" id="skm2Amount" value="0"
                        class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out financial-input text-left">
                </div>

                <div class="input-group">
                    <label for="skmLoyalCustomer" class="block text-sm font-medium text-gray-700">SKM ç†Ÿå®¢</label>
                    <input type="text" id="skmLoyalCustomer" value="0"
                        class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out financial-input text-left">
                </div>
                
                <div class="input-group">
                    <label for="externalAccount" class="block text-sm font-medium text-gray-700">å¤–å¸³</label>
                    <input type="text" id="externalAccount" value="0"
                        class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out financial-input text-left">
                </div>
            </div>
        </div>

        <div class="mt-10 pt-6 border-t border-blue-200">
            <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">ğŸ‰ æœ€çµ‚å°å¸³çµæœ ğŸ‰</h2>
            <div id="difference-display" class="p-6 rounded-xl shadow-xl text-center transition duration-300 ease-in-out bg-white border border-blue-300">
                <p class="text-7xl font-extrabold financial-input transition-colors duration-300" id="difference-value">0</p>
            </div>
            <p id="reconciliation-status" class="mt-4 text-center text-xl font-semibold"></p>
        </div>

        <p id="loading-status" class="mt-6 text-center text-sm text-gray-500">
            <span class="animate-pulse">æ•¸æ“šåŒæ­¥ä¸­...</span>
        </p>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // è¨­ç½®æ—¥èªŒç´šåˆ¥ç‚º Debug (å¯é¸)
        setLogLevel('Debug');

        // --- 1. åˆå§‹åŒ– Firebase ç›¸é—œå¸¸æ•¸å’Œè®Šæ•¸ ---
        let db, auth, userId;
        let isAuthReady = false;
        
        // å¾ Canvas ç’°å¢ƒè®Šæ•¸ç²å–é…ç½®
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // æ›´æ–° INPUT_IDS ä»¥åŒ…å«æ‰€æœ‰æ¬„ä½
        const INPUT_IDS = ['paymentTotal', 'preSaleSettlement', 'acPlus', 'skm1Amount', 'skm2Amount', 'externalAccount', 'skmLoyalCustomer'];
        const DIFF_VALUE_EL = document.getElementById('difference-value');
        const STATUS_EL = document.getElementById('reconciliation-status');
        const LOADING_EL = document.getElementById('loading-status');
        
        // --- Helper å‡½æ•¸ï¼šè™•ç†æ•¸å­—æ ¼å¼åŒ– ---

        /**
         * ç§»é™¤æ•¸å­—å­—ä¸²ä¸­çš„æ‰€æœ‰éæ•¸å­—å­—ç¬¦ï¼ˆåŒ…å«åƒåˆ†ä½ç¬¦è™Ÿï¼‰ï¼Œä½†ä¿ç•™å°æ•¸é»å’Œè² è™Ÿã€‚
         * @param {string | number} value - å¾…æ¸…ç†çš„å€¼ã€‚
         * @returns {string} æ¸…ç†å¾Œçš„æ•¸å­—å­—ä¸²ã€‚
         */
        function unformatNumber(value) {
            if (typeof value !== 'string') value = String(value);
            // å…è¨±æ•¸å­—ã€å°æ•¸é»å’Œé–‹é ­çš„è² è™Ÿ
            const cleaned = value.replace(/,/g, ''); // ç§»é™¤æ‰€æœ‰é€—è™Ÿ
            // ä¿ç•™æ•¸å­—ã€å°æ•¸é»ã€å’Œé–‹é ­çš„è² è™Ÿï¼Œä¸¦è™•ç†å¤šå€‹è² è™Ÿæˆ–å°æ•¸é»çš„æƒ…æ³ï¼ˆåªå–ç¬¬ä¸€å€‹ï¼‰
            let result = cleaned.replace(/[^-0-9.]/g, '');
            // ç¢ºä¿åªæœ‰ç¬¬ä¸€å€‹å­—ç¬¦æ˜¯è² è™Ÿ
            if (result.indexOf('-') > 0) {
                result = result.replace(/-/g, '');
            }
            // ç¢ºä¿åªæœ‰ä¸€å€‹å°æ•¸é»
            if ((result.match(/\./g) || []).length > 1) {
                const parts = result.split('.');
                result = parts.shift() + '.' + parts.join('');
            }
            return result;
        }

        /**
         * å°‡æ•¸å­—æˆ–æ•¸å­—å­—ä¸²æ ¼å¼åŒ–ç‚ºå¸¶æœ‰åƒä½æ•¸åˆ†éš”ç¬¦è™Ÿçš„å­—ä¸²ã€‚
         * @param {string | number} value - å¾…æ ¼å¼åŒ–çš„å€¼ã€‚
         * @returns {string} å¸¶æœ‰åƒåˆ†ä½ç¬¦è™Ÿçš„å­—ä¸²ã€‚
         */
        function formatNumberWithCommas(value) {
            const cleanedValue = unformatNumber(value);
            if (cleanedValue === '' || cleanedValue === '-') return cleanedValue;

            // ä½¿ç”¨ Intl.NumberFormat ç¢ºä¿æº–ç¢ºçš„åƒåˆ†ä½æ ¼å¼
            // ä½¿ç”¨ 'en-US' ç¢ºä¿ä½¿ç”¨é€—è™Ÿä½œç‚ºåƒåˆ†ä½åˆ†éš”ç¬¦
            return new Intl.NumberFormat('en-US').format(parseFloat(cleanedValue));
        }

        // --- 2. æ ¸å¿ƒè¨ˆç®—é‚è¼¯ ---
        function calculateDifference() {
            // å¾è¼¸å…¥æ¡†ç²å–æ•¸å€¼ (å…ˆå»é™¤åƒåˆ†ä½ç¬¦è™Ÿ)ï¼Œå¦‚æœç‚ºç©ºå‰‡è¦–ç‚º 0
            const paymentTotalStr = unformatNumber(document.getElementById('paymentTotal').value);
            const preSaleSettlementStr = unformatNumber(document.getElementById('preSaleSettlement').value);
            const acPlusStr = unformatNumber(document.getElementById('acPlus').value);
            const skm1AmountStr = unformatNumber(document.getElementById('skm1Amount').value); 
            const skm2AmountStr = unformatNumber(document.getElementById('skm2Amount').value); 
            const externalAccountStr = unformatNumber(document.getElementById('externalAccount').value);
            // è®€å– SKM ç†Ÿå®¢
            const skmLoyalCustomerStr = unformatNumber(document.getElementById('skmLoyalCustomer').value); 

            // è½‰æ›ç‚ºæµ®é»æ•¸é€²è¡Œè¨ˆç®—
            const paymentTotal = parseFloat(paymentTotalStr) || 0;
            const preSaleSettlement = parseFloat(preSaleSettlementStr) || 0;
            const acPlus = parseFloat(acPlusStr) || 0;
            const skm1Amount = parseFloat(skm1AmountStr) || 0;
            const skm2Amount = parseFloat(skm2AmountStr) || 0;
            const externalAccount = parseFloat(externalAccountStr) || 0;
            const skmLoyalCustomer = parseFloat(skmLoyalCustomerStr) || 0; 

            // è¨ˆç®—å·®ç•°ï¼š(Payment Total - é å”®çµå¸³ - AC+) - (SKM1 + SKM2 + SKM ç†Ÿå®¢ + å¤–å¸³)
            const difference = paymentTotal
                             - (preSaleSettlement + acPlus)
                             - (skm1Amount + skm2Amount + skmLoyalCustomer + externalAccount);

            // ç¢ºä¿åªå–å…©ä½å°æ•¸é»ï¼Œé¿å…æµ®é»æ•¸èª¤å·®
            return parseFloat(difference.toFixed(2));
        }

        // --- 3. æ›´æ–° UI é¡¯ç¤º ---
        function updateUI() {
            const difference = calculateDifference();
            
            // å·®ç•°é¡¯ç¤ºä»å¥—ç”¨åƒåˆ†ä½ç¬¦è™Ÿ
            DIFF_VALUE_EL.textContent = difference.toLocaleString('en-US');

            // ç§»é™¤æ‰€æœ‰é¡è‰²é¡åˆ¥
            DIFF_VALUE_EL.parentElement.classList.remove('bg-green-100', 'bg-red-100', 'border-green-400', 'border-red-400', 'border-blue-300');
            DIFF_VALUE_EL.classList.remove('text-green-800', 'text-red-800', 'text-gray-600');
            STATUS_EL.classList.remove('text-green-600', 'text-red-600');

            if (difference === 0) {
                // å¹³å¸³
                DIFF_VALUE_EL.parentElement.classList.add('bg-green-100', 'border-green-400');
                DIFF_VALUE_EL.classList.add('text-green-800');
                STATUS_EL.textContent = 'âœ… æ­å–œï¼ä»Šæ—¥å°å¸³ç„¡å·®ç•°ï¼';
                STATUS_EL.classList.add('text-green-600');
            } else if (difference > 0) {
                // æ–°å…‰å°‘æ”¶éŒ¢ (æˆ–æ˜ç´°æœªé€€)
                DIFF_VALUE_EL.parentElement.classList.add('bg-red-100', 'border-red-400');
                DIFF_VALUE_EL.classList.add('text-red-800');
                STATUS_EL.textContent = `ğŸš¨ å·®ç•° +${difference.toLocaleString('en-US')} (æ–°å…‰å°‘æ”¶éŒ¢ï¼Œéœ€è¿½è¹¤æ˜ç´°)`;
                STATUS_EL.classList.add('text-red-600');
            } else {
                // æ–°å…‰å¤šæ”¶éŒ¢ (æˆ–æ˜ç´°æœªå…¥)
                DIFF_VALUE_EL.parentElement.classList.add('bg-red-100', 'border-red-400');
                DIFF_VALUE_EL.classList.add('text-red-800');
                STATUS_EL.textContent = `ğŸš¨ å·®ç•° ${difference.toLocaleString('en-US')} (æ–°å…‰å¤šæ”¶éŒ¢ï¼Œéœ€è¿½è¹¤æ˜ç´°)`;
                STATUS_EL.classList.add('text-red-600');
            }
        }

        // --- 4. Firestore æ•¸æ“šæ“ä½œ ---

        // å–å¾—å–®ä¸€æ–‡ä»¶è·¯å¾‘ (Private Data)
        function getDocRef() {
            if (!db || !userId) return null;
            // è·¯å¾‘ï¼š/artifacts/{appId}/users/{userId}/reconciliation_tool/current_state
            return doc(db, 'artifacts', appId, 'users', userId, 'reconciliation_tool', 'current_state');
        }

        // å„²å­˜æ•¸æ“šåˆ° Firestore
        async function saveData() {
            if (!isAuthReady) return; // ç¢ºä¿èªè­‰å®Œæˆ
            
            const docRef = getDocRef();
            if (!docRef) return;

            const dataToSave = {};
            INPUT_IDS.forEach(id => {
                const inputEl = document.getElementById(id);
                // 1. unformat the string (å»é™¤åƒåˆ†ä½ç¬¦è™Ÿ)
                const unformattedStr = unformatNumber(inputEl.value);
                // 2. convert to number for storage (å„²å­˜ç´”æ•¸å­—)
                // å³ä½¿æ˜¯ç©ºå­—ä¸²ï¼ŒparseFloat å¾Œä¹Ÿæœƒæ˜¯ NaNï¼Œé€é || 0 ç¢ºä¿å­˜å„²çš„æ˜¯ 0
                const value = parseFloat(unformattedStr) || 0;
                dataToSave[id] = value;
            });

            try {
                // ä½¿ç”¨ setDoc è¦†å¯«æˆ–å‰µå»ºæ–‡ä»¶
                await setDoc(docRef, dataToSave);
            } catch (error) {
                console.error("Error saving data to Firestore:", error);
            }
        }

        // å¾ Firestore è¼‰å…¥æ•¸æ“šä¸¦è¨­å®šå³æ™‚ç›£è½
        function loadData() {
            const docRef = getDocRef();
            if (!docRef) return;

            // è¨­ç½® onSnapshot ç›£è½å™¨ä»¥å¯¦æ™‚ç²å–æ•¸æ“š
            onSnapshot(docRef, (docSnapshot) => {
                LOADING_EL.style.display = 'none'; // éš±è—è¼‰å…¥æç¤º
                if (docSnapshot.exists()) {
                    const data = docSnapshot.data();
                    // å°‡æ•¸æ“šå¡«å……å›è¼¸å…¥æ¡†
                    INPUT_IDS.forEach(id => {
                        const inputEl = document.getElementById(id);
                        if (data[id] !== undefined && inputEl) {
                            const numericValue = data[id];
                            
                            // æ•¸å­— 0 é¡¯ç¤ºç‚º '0'
                            if (numericValue !== 0) {
                                // è¼‰å…¥æ™‚ï¼Œç›´æ¥é¡¯ç¤ºç´”æ•¸å­—
                                inputEl.value = numericValue.toString();
                            } else {
                                // å¦‚æœç‚º 0ï¼Œå‰‡é¡¯ç¤º '0'
                                inputEl.value = '0';
                            }
                        }
                    });
                    console.log("Data loaded from Firestore successfully.");
                } else {
                    console.log("No data found, using default '0' values.");
                    // å¦‚æœæ²’æœ‰æ•¸æ“šï¼Œç¢ºä¿æ‰€æœ‰æ¬„ä½éƒ½è¨­å®šç‚º '0'
                    INPUT_IDS.forEach(id => {
                        const inputEl = document.getElementById(id);
                        if(inputEl) inputEl.value = '0';
                    });
                }
                // ç„¡è«–è¼‰å…¥æˆåŠŸèˆ‡å¦ï¼Œéƒ½æ‡‰æ›´æ–° UI
                updateUI();
            }, (error) => {
                console.error("Error listening to Firestore data:", error);
                LOADING_EL.textContent = 'è¼‰å…¥æ•¸æ“šå¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦ã€‚';
                updateUI(); // ä»ç„¶ä½¿ç”¨ç•¶å‰è¼¸å…¥å€¼é€²è¡Œè¨ˆç®—
            });
        }

        // --- 5. äº‹ä»¶ç›£è½å™¨å’Œåˆå§‹åŒ– ---

        function setupEventListeners() {
            INPUT_IDS.forEach(id => {
                const inputEl = document.getElementById(id);
                if (inputEl) {
                    // ç›£è½è¼¸å…¥è®ŠåŒ–ï¼Œå³æ™‚æ›´æ–° UI 
                    inputEl.addEventListener('input', function() {
                        const caretPos = this.selectionStart;
                        
                        // ç§»é™¤æ‰€æœ‰éæ•¸å­—å­—ç¬¦ (ä¸å«åƒåˆ†ä½)
                        const cleanedValue = unformatNumber(this.value);
                        this.value = cleanedValue;
                        
                        // å˜—è©¦ä¿ç•™æ¸¸æ¨™ä½ç½®
                        this.setSelectionRange(caretPos, caretPos);

                        // æ›´æ–°è¨ˆç®—å’Œå„²å­˜
                        updateUI();
                        // ä½¿ç”¨ setTimeout é€²è¡Œç°¡å–®çš„å»æŠ–å‹• (debounce) ä»¥æ¸›å°‘å¯«å…¥æ¬¡æ•¸
                        clearTimeout(this.saveTimer);
                        this.saveTimer = setTimeout(saveData, 500);
                    });
                    
                    // ç›£è½ blur äº‹ä»¶ï¼Œç¢ºä¿æ¬„ä½å¤±ç„¦æ™‚ï¼Œç©ºå€¼æœƒè®Šæˆ '0'
                    inputEl.addEventListener('blur', function() {
                        // è™•ç†ç©ºå€¼ã€å–®å€‹è² è™Ÿæˆ–å–®å€‹å°æ•¸é»çš„æƒ…æ³
                        if (this.value === '' || this.value === '-' || this.value === '.') {
                            this.value = '0';
                            updateUI(); // ç¢ºä¿ UI ç«‹å³æ›´æ–°
                            saveData(); // ç«‹å³å­˜å„² '0'
                        }
                    });
                }
            });
        }

        // Firebase åˆå§‹åŒ–å’Œèªè­‰æµç¨‹
        async function initializeFirebase() {
            if (!firebaseConfig) {
                console.error("Firebase configuration is missing.");
                LOADING_EL.textContent = 'Firebase é…ç½®ç¼ºå¤±ï¼Œæ•¸æ“šç„¡æ³•ä¿å­˜ã€‚';
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // è™•ç†èªè­‰
                await new Promise((resolve) => {
                    // Firebase Auth ç‹€æ…‹è®Šæ›´ç›£è½
                    const unsubscribe = onAuthStateChanged(auth, async (user) => {
                        unsubscribe(); // åªéœ€è¦ç›£è½ä¸€æ¬¡
                        if (user) {
                            userId = user.uid;
                        } else {
                            // ä½¿ç”¨æä¾›çš„ custom token ç™»å…¥ï¼Œå¦‚æœæ²’æœ‰å‰‡åŒ¿åç™»å…¥
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                                userId = auth.currentUser.uid;
                            } else {
                                await signInAnonymously(auth);
                                userId = auth.currentUser.uid;
                            }
                        }
                        isAuthReady = true;
                        resolve();
                    });
                });

                console.log("Firebase Auth Ready. User ID:", userId);
                // èªè­‰å®Œæˆå¾Œï¼Œé–‹å§‹è¼‰å…¥å’Œç›£è½æ•¸æ“š
                loadData();
                
            } catch (error) {
                console.error("Firebase initialization or authentication failed:", error);
                LOADING_EL.textContent = 'Firebase åˆå§‹åŒ–æˆ–èªè­‰å¤±æ•—ã€‚';
            }
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œ
        window.onload = function() {
            setupEventListeners();
            // åˆå§‹å€¼éƒ½è¨­å®šç‚º '0'
            INPUT_IDS.forEach(id => {
                const inputEl = document.getElementById(id);
                if(inputEl) inputEl.value = '0';
            });
            updateUI();
            initializeFirebase();
        };

    </script>
</body>
</html>
